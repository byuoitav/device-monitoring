{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nimport { JsonConvert, JsonObject, JsonProperty, Any, JsonConverter } from \"json2typescript\";\nimport * as i0 from \"@angular/core\";\nfunction ProvisioningComponent_mat_progress_bar_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-progress-bar\", 2);\n  }\n}\nexport let ProvisioningComponent = /*#__PURE__*/(() => {\n  class ProvisioningComponent {\n    constructor() {\n      this.jsonConvert = new JsonConvert();\n      this.jsonConvert.ignorePrimitiveChecks = false;\n    }\n    ngOnInit() {\n      this.openSocket();\n    }\n    openSocket() {\n      this.socket = new WebSocket(\"ws://\" + window.location.host + \"/provisioning/ws\");\n      this.socket.onopen = () => {\n        console.log(\"socket connection successfully opened.\");\n      };\n      this.socket.onmessage = message => {\n        const data = JSON.parse(message.data);\n        const event = this.jsonConvert.deserializeObject(data, Event);\n        this.onEvent(event);\n      };\n      // try to reconnect when socket is closed\n      this.socket.onclose = () => {\n        console.log(\"socket connection closed. retrying in 5 seconds...\");\n        setTimeout(() => {\n          this.openSocket();\n        }, 5 * 1000);\n      };\n    }\n    onEvent(event) {\n      console.log(\"received event:\", event);\n    }\n    static #_ = this.ɵfac = function ProvisioningComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || ProvisioningComponent)();\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ProvisioningComponent,\n      selectors: [[\"provisioning\"]],\n      decls: 2,\n      vars: 1,\n      consts: [[\"color\", \"accent\", \"mode\", \"query\", 4, \"ngIf\"], [1, \"container\"], [\"color\", \"accent\", \"mode\", \"query\"]],\n      template: function ProvisioningComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵtemplate(0, ProvisioningComponent_mat_progress_bar_0_Template, 1, 0, \"mat-progress-bar\", 0);\n          i0.ɵɵelement(1, \"div\", 1);\n        }\n        if (rf & 2) {\n          i0.ɵɵproperty(\"ngIf\", ctx.socket.readyState === 0 || ctx.socket.readyState === 3);\n        }\n      },\n      styles: [\".container[_ngcontent-%COMP%]{width:95%;margin:1.5em auto}\"]\n    });\n  }\n  return ProvisioningComponent;\n})();\nlet BasicRoomInfo = class BasicRoomInfo {\n  constructor(roomID) {\n    this.BuildingID = \"\";\n    this.RoomID = \"\";\n    if (roomID == null || roomID === undefined) {\n      return;\n    }\n    const split = roomID.split(\"-\");\n    if (split.length === 2) {\n      this.BuildingID = split[0];\n      this.RoomID = split[0] + \"-\" + split[1];\n    }\n  }\n};\n__decorate([JsonProperty(\"buildingID\", String, true), __metadata(\"design:type\", Object)], BasicRoomInfo.prototype, \"BuildingID\", void 0);\n__decorate([JsonProperty(\"roomID\", String, true), __metadata(\"design:type\", Object)], BasicRoomInfo.prototype, \"RoomID\", void 0);\nBasicRoomInfo = __decorate([JsonObject(\"BasicRoomInfo\"), __metadata(\"design:paramtypes\", [String])], BasicRoomInfo);\nexport { BasicRoomInfo };\nlet BasicDeviceInfo = class BasicDeviceInfo {\n  constructor(deviceID) {\n    this.BuildingID = \"\";\n    this.RoomID = \"\";\n    this.DeviceID = \"\";\n    if (deviceID == null || deviceID === undefined) {\n      return;\n    }\n    const split = deviceID.split(\"-\");\n    if (split.length === 3) {\n      this.BuildingID = split[0];\n      this.RoomID = split[0] + \"-\" + split[1];\n      this.DeviceID = split[0] + \"-\" + split[1] + \"-\" + split[2];\n    }\n  }\n};\n__decorate([JsonProperty(\"buildingID\", String, true), __metadata(\"design:type\", Object)], BasicDeviceInfo.prototype, \"BuildingID\", void 0);\n__decorate([JsonProperty(\"roomID\", String, true), __metadata(\"design:type\", Object)], BasicDeviceInfo.prototype, \"RoomID\", void 0);\n__decorate([JsonProperty(\"deviceID\", String, true), __metadata(\"design:type\", Object)], BasicDeviceInfo.prototype, \"DeviceID\", void 0);\nBasicDeviceInfo = __decorate([JsonObject(\"BasicDeviceInfo\"), __metadata(\"design:paramtypes\", [String])], BasicDeviceInfo);\nexport { BasicDeviceInfo };\nlet DateConverter = class DateConverter {\n  serialize(date) {\n    function pad(n) {\n      return n < 10 ? \"0\" + n : n;\n    }\n    return date.getUTCFullYear() + \"-\" + pad(date.getUTCMonth() + 1) + \"-\" + pad(date.getUTCDate()) + \"T\" + pad(date.getUTCHours()) + \":\" + pad(date.getUTCMinutes()) + \":\" + pad(date.getUTCSeconds()) + \"Z\";\n  }\n  deserialize(date) {\n    return new Date(date);\n  }\n};\nDateConverter = __decorate([JsonConverter], DateConverter);\nlet Event = class Event {\n  constructor() {\n    this.GeneratingSystem = \"\";\n    this.Timestamp = undefined;\n    this.EventTags = [];\n    this.TargetDevice = new BasicDeviceInfo(undefined);\n    this.AffectedRoom = new BasicRoomInfo(undefined);\n    this.Key = \"\";\n    this.Value = \"\";\n    this.User = \"\";\n    this.Data = undefined;\n  }\n  hasTag(tag) {\n    return this.EventTags.includes(tag);\n  }\n};\n__decorate([JsonProperty(\"generating-system\", String, true), __metadata(\"design:type\", Object)], Event.prototype, \"GeneratingSystem\", void 0);\n__decorate([JsonProperty(\"timestamp\", DateConverter, true), __metadata(\"design:type\", Date)], Event.prototype, \"Timestamp\", void 0);\n__decorate([JsonProperty(\"event-tags\", [String], true), __metadata(\"design:type\", Array)], Event.prototype, \"EventTags\", void 0);\n__decorate([JsonProperty(\"target-device\", BasicDeviceInfo, true), __metadata(\"design:type\", Object)], Event.prototype, \"TargetDevice\", void 0);\n__decorate([JsonProperty(\"affected-room\", BasicRoomInfo, true), __metadata(\"design:type\", Object)], Event.prototype, \"AffectedRoom\", void 0);\n__decorate([JsonProperty(\"key\", String, true), __metadata(\"design:type\", Object)], Event.prototype, \"Key\", void 0);\n__decorate([JsonProperty(\"value\", String, true), __metadata(\"design:type\", Object)], Event.prototype, \"Value\", void 0);\n__decorate([JsonProperty(\"user\", String, true), __metadata(\"design:type\", Object)], Event.prototype, \"User\", void 0);\n__decorate([JsonProperty(\"data\", Any, true), __metadata(\"design:type\", Object)], Event.prototype, \"Data\", void 0);\nEvent = __decorate([JsonObject(\"Event\")], Event);\nexport { Event };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}