{"ast":null,"code":"import _asyncToGenerator from \"/home/orcrist/Desktop/device-monitoring/dashboard/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { HttpClient } from \"@angular/common/http\";\nimport { JsonConvert } from \"json2typescript\";\nimport { DeviceInfo, Status, PingResult, RunnerInfo, ViaInfo } from \"../objects\";\nimport { MatDialog } from \"@angular/material/dialog\";\nimport { RebootComponent } from \"../popups/reboot/reboot.component\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/material/dialog\";\nexport let APIService = /*#__PURE__*/(() => {\n  class APIService {\n    constructor(http, dialog) {\n      this.http = http;\n      this.dialog = dialog;\n      this.theme = \"default\";\n      this.jsonConvert = new JsonConvert();\n      this.jsonConvert.ignorePrimitiveChecks = false;\n      this.urlParams = new URLSearchParams(window.location.search);\n      if (this.urlParams.has(\"theme\")) {\n        this.theme = this.urlParams.get(\"theme\");\n      }\n    }\n    switchToUI() {\n      window.location.pathname = \"/ui\";\n    }\n    refresh() {\n      window.location.reload(true);\n    }\n    switchTheme(name) {\n      console.log(\"switching theme to\", name);\n      this.theme = name;\n      this.urlParams.set(\"theme\", name);\n      window.history.replaceState(null, \"System Health Dashboard\", window.location.pathname + \"?\" + this.urlParams.toString());\n    }\n    reboot() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        try {\n          _this.dialog.open(RebootComponent, {\n            disableClose: true\n          });\n          const data = yield _this.http.put(\"device/reboot\", {\n            responseType: \"text\"\n          }).toPromise();\n        } catch (e) {\n          // bug where responseType doesn't actually work\n          if (e.status === 200) {\n            console.log(e.error.text);\n            return e.error.text;\n          }\n          throw new Error(\"error getting rebooting device: \" + e);\n        }\n      })();\n    }\n    getDeviceInfo() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const data = yield _this2.http.get(\"device\").toPromise();\n          const deviceInfo = _this2.jsonConvert.deserializeObject(data, DeviceInfo);\n          return deviceInfo;\n        } catch (e) {\n          const deviceInfo = _this2.jsonConvert.deserializeObject(e.error, DeviceInfo);\n          console.error(\"error getting device info:\", e);\n          return deviceInfo;\n        }\n      })();\n    }\n    getMaintenanceMode() {\n      return _asyncToGenerator(function* () {\n        return false;\n        /*\n        try {\n          const data = await this.http.get(\"maintenance\").toPromise();\n               return (<any>data) as boolean;\n        } catch (e) {\n          throw new Error(\"error getting maintenance mode: \" + e);\n        }\n         */\n      })();\n    }\n    toggleMaintenanceMode() {\n      return _asyncToGenerator(function* () {\n        return false;\n        /*\n        try {\n          const data = await this.http.put(\"maintenance\", null).toPromise();\n               return (<any>data) as boolean;\n        } catch (e) {\n          throw new Error(\"error toggling maintenance mode: \" + e);\n        }\n         */\n      })();\n    }\n    getSoftwareStati() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const data = yield _this3.http.get(\"device/status\").toPromise();\n          const stati = _this3.jsonConvert.deserializeObject(data, Status);\n          return stati;\n        } catch (e) {\n          throw new Error(\"error getting software status': \" + e);\n        }\n      })();\n    }\n    getDeviceID() {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const data = yield _this4.http.get(\"device/id\", {\n            responseType: \"text\"\n          }).toPromise();\n          return data;\n        } catch (e) {\n          throw new Error(\"error getting device id: \" + e);\n        }\n      })();\n    }\n    getRoomPing() {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const data = yield _this5.http.get(\"room/ping\").toPromise();\n          // build the map\n          const result = new Map();\n          for (const key of Object.keys(data)) {\n            if (key && data[key]) {\n              const val = _this5.jsonConvert.deserializeObject(data[key], PingResult);\n              result.set(key, val);\n            }\n          }\n          return result;\n        } catch (e) {\n          throw new Error(\"error getting room ping info: \" + e);\n        }\n      })();\n    }\n    getRoomHealth() {\n      var _this6 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const data = yield _this6.http.get(\"room/health\").toPromise();\n          // build the map\n          const result = new Map();\n          for (const key of Object.keys(data)) {\n            if (key && data[key]) {\n              result.set(key, data[key]);\n            }\n          }\n          return result;\n        } catch (e) {\n          throw new Error(\"error getting room ping info: \" + e);\n        }\n      })();\n    }\n    getRunnerInfo() {\n      var _this7 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const data = yield _this7.http.get(\"device/runners\").toPromise();\n          const info = _this7.jsonConvert.deserializeArray(data, RunnerInfo);\n          return info;\n        } catch (e) {\n          throw new Error(\"error getting device runner info: \" + e);\n        }\n      })();\n    }\n    getViaInfo() {\n      var _this8 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const data = yield _this8.http.get(\"room/viainfo\").toPromise();\n          const info = _this8.jsonConvert.deserializeArray(data, ViaInfo);\n          return info;\n        } catch (e) {\n          throw new Error(\"error getting via info: \" + e);\n        }\n      })();\n    }\n    resetVia(address) {\n      var _this9 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const data = yield _this9.http.get(\"http://\" + location.hostname + \":8014/via/\" + address + \"/reset\").toPromise();\n          console.log(\"data\", data);\n        } catch (e) {\n          throw new Error(\"error resetting via: \" + e);\n        }\n      })();\n    }\n    rebootVia(address) {\n      var _this10 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const data = yield _this10.http.get(\"http://\" + location.hostname + \":8014/via/\" + address + \"/reboot\").toPromise();\n          console.log(\"data\", data);\n        } catch (e) {\n          throw new Error(\"error rebooting via: \" + e);\n        }\n      })();\n    }\n    getDividerSensorsStatus(address) {\n      var _this11 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const data = yield _this11.http.get(\"http://\" + address + \":10000/divider/state\").toPromise();\n          console.log(\"data\", data);\n          for (const [key] of Object.entries(data)) {\n            if (key.includes(\"disconnected\")) {\n              return false;\n            }\n            if (key.includes(\"connected\")) {\n              return true;\n            }\n          }\n        } catch (e) {\n          throw new Error(\"error getting divider sensors connection status: \" + e);\n        }\n      })();\n    }\n    getHardwareInfo() {\n      var _this12 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const data = yield _this12.http.get(\"/device/hardwareinfo\").toPromise();\n          console.log(\"data\", data);\n          return data;\n        } catch (e) {\n          throw new Error(\"error getting hardware info: \" + e);\n        }\n      })();\n    }\n    flushDNS() {\n      var _this13 = this;\n      return _asyncToGenerator(function* () {\n        _this13.http.get(\"/dns\").subscribe(data => {\n          if (data == \"success\") {\n            console.log(\"successfully flushed the dns cache\");\n          } else {\n            console.log(\"failed to flush the dns cache\");\n          }\n        });\n      })();\n    }\n    // reSyncDB (Swab)\n    reSyncDB() {\n      var _this14 = this;\n      return _asyncToGenerator(function* () {\n        _this14.http.get(\"/resyncDB\").subscribe(data => {\n          if (data == \"success\") {\n            console.log(\"successfully resynced the database\");\n          } else {\n            console.log(\"failed to resync the database\");\n          }\n        });\n      })();\n    }\n    // refreshContainers (Float)\n    refreshContainers() {\n      var _this15 = this;\n      return _asyncToGenerator(function* () {\n        _this15.http.get(\"/refreshContainers\").subscribe(data => {\n          if (data == \"success\") {\n            console.log(\"successfully refreshed the containers\");\n          } else {\n            console.log(\"failed to refresh the containers\");\n          }\n        });\n      })();\n    }\n    static #_ = this.ɵfac = function APIService_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || APIService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.MatDialog));\n    };\n    static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: APIService,\n      factory: APIService.ɵfac,\n      providedIn: \"root\"\n    });\n  }\n  return APIService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}